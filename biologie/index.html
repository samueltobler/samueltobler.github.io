<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Willkommens- & Abschiedsgrüsse</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; }
    * { margin: 0; }
    html, body { height: 100%; }
    body { line-height: 1.5; -webkit-font-smoothing: antialiased; font-family: "Inter", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
    :focus-visible { outline: 2px solid #7c9cff; outline-offset: 2px; }

    :root {
      --radius: 14px; --btn-h: 44px; --shadow-1: 0 10px 30px rgba(0,0,0,.06); --shadow-2: 0 20px 50px rgba(0,0,0,.10);
      --text: #2b2633; --muted: #6b6474; --elev: #ffffff; --primary: #9b6bff; --primary-600: #7f4dff; --accent: #ff7c6b; --accent-600: #fa5f49;
      --card-grad: radial-gradient(1200px 700px at 0% -10%, rgba(255,220,196,.55), transparent 50%),
                   radial-gradient(900px 600px at 100% 10%, rgba(214,199,255,.55), transparent 50%);
      --app-grad: linear-gradient(180deg, #fff7f0 0%, #fffdfb 40%, #ffffff 100%);
    }

    body { background: var(--app-grad); color: var(--text); }
    .app { min-height: 100dvh; display: grid; grid-template-rows: auto 1fr; background: var(--card-grad); }

    .appbar { position: sticky; top: 0; background: color-mix(in oklab, var(--elev) 85%, transparent); box-shadow: var(--shadow-1); backdrop-filter: saturate(140%) blur(8px); border-bottom: 1px solid rgba(0,0,0,.06); }
    .appbar-inner { max-width: 1100px; margin: 0 auto; display: flex; align-items: center; gap: 12px; padding: 12px 24px; }
    .brand { display: flex; align-items: center; gap: 12px; font-weight: 700; }
    .logo { width: 34px; height: 34px; border-radius: 10px; display: grid; place-items: center; background: conic-gradient(from 210deg, var(--accent), var(--primary)); color: white; box-shadow: var(--shadow-1); font-size: 22px; }

    .hero { max-width: 1100px; margin: 0 auto; padding: 24px; display: grid; gap: 12px; }
    .hero p { color: var(--muted); }

    .board { max-width: 1100px; margin: 0 auto; padding: 0 24px 120px; }
    .grid { display: grid; grid-template-columns: repeat(12, minmax(0, 1fr)); gap: 16px; }
    .card { grid-column: span 12; border-radius: var(--radius); background: color-mix(in oklab, var(--elev) 95%, transparent); border: 1px solid rgba(0,0,0,.06); box-shadow: var(--shadow-1); overflow: hidden; }
    .card-inner { padding: 18px; display: grid; gap: 10px; }
    .meta { display: flex; align-items: center; gap: 12px; }
    .emoji { font-size: 22px; }
    .who { font-weight: 700; }
    .sub { color: var(--muted); font-size: 14px; }
    .msg { font-size: 16px; }

    @media (min-width: 640px) { .card { grid-column: span 6; } }
    @media (min-width: 980px) { .card { grid-column: span 4; } }
  </style>
</head>
<body>
  <div class="app">
    <header class="appbar">
      <div class="appbar-inner">
        <div class="brand">
          <div class="logo" aria-hidden="true">❤</div>
          <div class="title">Willkommens- & Abschiedsgrüsse</div>
        </div>
      </div>
    </header>

    <section class="hero">
      <p>Unsere Wünsche und Tipps für euren Weg!</p>
    </section>

    <main class="board">
      <div id="grid" class="grid" role="list"></div>
    </main>
  </div>

  <script>
  // Robust & einfach: JSON direkt aus OpenSheet (keine CORS-/gviz-/CSV-Probleme)
  // Voraussetzungen im Sheet: Tab-Name exakt "messages"; erste Zeile: id | who | klasse | date | emoji | text
  // Freigabe: "Jede Person mit Link – Betrachter" genügt; Veröffentlichen im Web ist nicht nötig.
  const OPENSHEET_URL = 'https://opensheet.elk.sh/1hlCxUuxBEJhBOiJtbEpka9_ecqfcmd5cUUlckWUCVvc/messages'

  const grid = document.getElementById('grid')
  const fmtDE = new Intl.DateTimeFormat('de-CH', { day:'numeric', month:'long', year:'numeric' })
  const esc = s => String(s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\\':'&#39;'}[c]))
  function formatDatePretty(iso){ if(!iso) return ''; const [y,m,d]=String(iso).split('-').map(n=>parseInt(n,10)); if(!y||!m||!d) return iso; return fmtDE.format(new Date(Date.UTC(y,m-1,d))) }

  function card(m){
    const sub = [m.klasse?`Klasse ${esc(m.klasse)}`:null, formatDatePretty(m.date)].filter(Boolean).join(' · ')
    return `<article class="card" role="listitem"><div class="card-inner"><div class="meta"><div class="emoji">${esc(m.emoji)}</div><div><div class="who">${esc(m.who)}</div><div class="sub">${esc(sub)}</div></div></div><div class="msg">${esc(m.text)}</div></div></article>`
  }
  function render(list){ grid.innerHTML = (list||[]).map(card).join('') || '<p>Keine Einträge gefunden.</p>' }

  async function load(){
    try {
      const res = await fetch(OPENSHEET_URL, { cache:'no-store' })
      if(!res.ok) throw new Error('HTTP '+res.status)
      const rows = await res.json() // [{id,who,klasse,date,emoji,text}, ...]
      const items = rows
        .filter(r => String(r.id||'').trim() !== '')
        .map(r => ({ id:r.id, who:r.who, klasse:r.klasse, date:r.date, emoji:r.emoji, text:r.text }))
      items.sort((a,b)=> String(a.date)<String(b.date)?1:-1)
      render(items)
    } catch(err){
      grid.innerHTML = `<p>Keine Daten geladen. ${esc(err.message)} – Prüfe die Sheet-Freigabe oder ob der Tab <code>messages</code> heisst.</p>`
    }
  }

  load()
</script>
</body>
</html>
